From bd84a4e3caa77e5310e591dde65a0a12014acf59 Mon Sep 17 00:00:00 2001
From: Thecrazyskull <anaskarbila@gmail.com>
Date: Fri, 10 Feb 2017 09:38:50 -0500
Subject: [PATCH] Launcher3: Double tap on home screen to turn off screen

Change-Id: I554c005d5e523aca0842c78a353686e86af1a7f2
Signed-off-by: Mesquita <mickaelmendes50@gmail.com>
Signed-off-by: Omkar Chandorkar <gotenksIN@aosip.dev>
---
 Android.mk                                            |  1 +
 AndroidManifest-common.xml                            |  2 ++
 .../launcher3/touch/WorkspaceTouchListener.java       | 11 +++++++++++
 3 files changed, 14 insertions(+)

diff --git a/Android.mk b/Android.mk
index c222f24afa..6ebd47ecec 100644
--- a/Android.mk
+++ b/Android.mk
@@ -105,6 +105,7 @@ else
   LOCAL_MIN_SDK_VERSION := 26
 endif
 LOCAL_PACKAGE_NAME := Launcher3QuickStep
+LOCAL_CERTIFICATE := platform
 LOCAL_PRIVILEGED_MODULE := true
 LOCAL_SYSTEM_EXT_MODULE := true
 LOCAL_OVERRIDES_PACKAGES := Home Launcher2 Launcher3
diff --git a/AndroidManifest-common.xml b/AndroidManifest-common.xml
index 73afe4a7d1..6f54a0b837 100644
--- a/AndroidManifest-common.xml
+++ b/AndroidManifest-common.xml
@@ -42,6 +42,8 @@
     <uses-permission android:name="android.permission.QUERY_ALL_PACKAGES" />
     <!-- for rotating surface by arbitrary degree -->
     <uses-permission android:name="android.permission.ROTATE_SURFACE_FLINGER" />
+
+    <uses-permission android:name="android.permission.DEVICE_POWER" />
     
     <!--
     Permissions required for read/write access to the workspace data. These permission name
diff --git a/src/com/android/launcher3/touch/WorkspaceTouchListener.java b/src/com/android/launcher3/touch/WorkspaceTouchListener.java
index 4fa658e7d5..96955dcdf8 100644
--- a/src/com/android/launcher3/touch/WorkspaceTouchListener.java
+++ b/src/com/android/launcher3/touch/WorkspaceTouchListener.java
@@ -24,8 +24,10 @@ import static android.view.MotionEvent.ACTION_UP;
 import static com.android.launcher3.LauncherState.NORMAL;
 import static com.android.launcher3.logging.StatsLogManager.LauncherEvent.LAUNCHER_WORKSPACE_LONGPRESS;
 
+import android.content.Context;
 import android.graphics.PointF;
 import android.graphics.Rect;
+import android.os.PowerManager;
 import android.view.GestureDetector;
 import android.view.HapticFeedbackConstants;
 import android.view.MotionEvent;
@@ -68,6 +70,8 @@ public class WorkspaceTouchListener extends GestureDetector.SimpleOnGestureListe
 
     private int mLongPressState = STATE_CANCELLED;
 
+    private final PowerManager mPm;
+
     private final GestureDetector mGestureDetector;
 
     public WorkspaceTouchListener(Launcher launcher, Workspace workspace) {
@@ -76,6 +80,7 @@ public class WorkspaceTouchListener extends GestureDetector.SimpleOnGestureListe
         // Use twice the touch slop as we are looking for long press which is more
         // likely to cause movement.
         mTouchSlop = 2 * ViewConfiguration.get(launcher).getScaledTouchSlop();
+        mPm = (PowerManager) workspace.getContext().getSystemService(Context.POWER_SERVICE);
         mGestureDetector = new GestureDetector(workspace.getContext(), this);
     }
 
@@ -181,4 +186,10 @@ public class WorkspaceTouchListener extends GestureDetector.SimpleOnGestureListe
             }
         }
     }
+
+    @Override
+    public boolean onDoubleTap(MotionEvent event) {
+        mPm.goToSleep(event.getEventTime());
+        return true;
+    }
 }
-- 
2.34.0

